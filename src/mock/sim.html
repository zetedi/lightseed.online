<!DOCTYPE html>
<!-- saved from url=(0141)file:///private/var/folders/fy/pwy5cmsd5vg_tm1trf44xs4m0000gn/T/remote-file-preview-22CE61F7-95EB-443D-AEB2-72CDAFEDA59B/interaction-sim.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Lifetree Pulse &amp; Interaction Simulator (Mock)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0b0f12;
      --card: #121820;
      --muted: #96a0aa;
      --text: #e6eef5;
      --accent: #ffe100;
      --ok: #31d0aa;
      --warn: #ffb02e;
      --glow: 0 0 18px rgba(255, 225, 0, 0.35);
      --border: 1px solid rgba(255, 255, 255, 0.08);
      --radius: 14px;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font: 15px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: radial-gradient(1000px 700px at 10% -10%, rgba(255, 225, 0, 0.06), transparent), var(--bg);
    }
    header {
      padding: 24px;
      display: flex;
      gap: 14px;
      align-items: center;
      border-bottom: var(--border);
      position: sticky;
      top: 0;
      background: rgba(11, 15, 18, 0.6);
      backdrop-filter: blur(8px);
    }
    header .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: var(--glow);
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.2px;
    }
    main {
      padding: 24px;
      display: grid;
      gap: 18px;
      grid-template-columns: 340px 1fr 400px;
    }
    /* Responsive layout: stack cards on smaller screens */
    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), transparent), var(--card);
      border: var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .card h2 {
      font-size: 14px;
      margin: 0;
      padding: 12px 14px;
      color: var(--muted);
      border-bottom: var(--border);
      letter-spacing: 0.3px;
    }
    .card .inner {
      padding: 14px;
      display: grid;
      gap: 12px;
    }
    /* Pulse list styling */
    #pulseList .pulse-item {
      border: var(--border);
      border-radius: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.02);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    #pulseList .pulse-item:hover {
      background: rgba(255, 255, 255, 0.04);
    }
    #pulseList .pulse-name {
      font-weight: 600;
    }
    #pulseList .pulse-id {
      font-size: 12px;
      color: var(--muted);
    }
    /* Match item styling (reuses previous styles) */
    .match {
      border: var(--border);
      border-radius: 10px;
      padding: 10px;
      display: grid;
      gap: 6px;
      background: rgba(255, 255, 255, 0.02);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .pill {
      font-size: 12px;
      color: var(--muted);
      padding: 3px 8px;
      border-radius: 999px;
      border: var(--border);
      background: rgba(255, 255, 255, 0.02);
    }
    .btn {
      appearance: none;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: #0f141a;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.15s ease;
      font-weight: 600;
    }
    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(255, 255, 255, 0.22);
    }
    .btn.primary {
      border-color: rgba(255, 225, 0, 0.55);
      background: #171d06;
      color: #fff2a8;
      box-shadow: var(--glow);
    }
    .muted {
      color: var(--muted);
    }
    .chat {
      display: grid;
      gap: 10px;
      height: 380px;
      overflow: auto;
      padding-right: 6px;
    }
    .msg {
      max-width: 80%;
      padding: 10px 12px;
      border-radius: 12px;
      line-height: 1.4;
      background: rgba(255, 255, 255, 0.04);
      border: var(--border);
    }
    .me {
      margin-left: auto;
      background: rgba(255, 225, 0, 0.07);
      border: 1px solid rgba(255, 225, 0, 0.3);
    }
    .sys {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
      margin: 8px 0;
    }
    .composer {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
    }
    input,
    textarea {
      width: 100%;
      background: #0f151b;
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    code,
    pre {
      background: #0c1217;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 10px;
      overflow: auto;
    }
    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .agree {
      display: grid;
      gap: 8px;
    }
    .ok {
      color: var(--ok);
    }
    .warn {
      color: var(--warn);
    }
    footer {
      padding: 16px;
      text-align: center;
      color: var(--muted);
      border-top: var(--border);
    }
    .mini {
      font-size: 12px;
    }
    /* Hide the interaction view until a pulse is selected */
    #interactionView {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <div class="dot" aria-hidden=""></div>
    <h1>Lifetree Pulse &amp; Interaction Simulator · Mock</h1>
  </header>

  <!-- Pulse selection view -->
  <div id="pulseSelection" style="padding: 24px;">
    <section class="card">
      <h2>Select Your Pulse</h2>
      <div class="inner">
        <p class="muted mini">Choose a pulse to see its intention matches and start a dialogue.</p>
        <div id="pulseList"><div class="pulse-item"><div class="pulse-name">Mentorship / Web Audit</div><div class="pulse-id">pulse-7H3A</div></div><div class="pulse-item"><div class="pulse-name">Visual Identity / Photo</div><div class="pulse-id">pulse-8K1Q</div></div></div>
      </div>
    </section>
  </div>

  <!-- Main interaction view (hidden until a pulse is selected) -->
  <div id="interactionView">
    <main>
      <!-- LEFT: Matches (Pulse alignment) -->
      <section class="card" id="matches">
        <h2>Intention Matches (Pulse)</h2>
        <div class="inner" id="matchList"></div>
      </section>

      <!-- CENTER: Conversation & Agreement -->
      <section class="card">
        <h2>Dialogue &amp; Agreement</h2>
        <div class="inner">
          <div class="chat" id="chat"></div>
          <div class="composer">
            <textarea id="message" placeholder="Propose an exchange… (e.g., 2 hrs mentorship ↔ web audit + 1 leaf)"></textarea>
            <button class="btn primary" id="send">Send</button>
          </div>
          <div class="grid2">
            <div>
              <div class="label">My Lifetree</div>
              <input id="fromTree" value="phoenix@waterloo">
            </div>
            <div>
              <div class="label">Partner Lifetree</div>
              <input id="toTree" value="" placeholder="auto-filled when selecting a match">
            </div>
          </div>
          <div class="grid2">
            <div>
              <div class="label">Pulse / Intention ID</div>
              <input id="pulseId" placeholder="auto from match">
            </div>
            <div>
              <div class="label">Leaves (amount)</div>
              <input id="leaves" type="number" min="0" step="0.1" placeholder="e.g. 1.0">
            </div>
          </div>
          <div class="agree">
            <button class="btn" id="genAgreement">Generate Agreement Summary</button>
            <pre id="agreement" class="mini muted">// agreement summary will appear here</pre>
            <button class="btn primary" id="signRecord">Sign &amp; Record on Chain (Mock)</button>
            <div class="mini muted">Uses Web Crypto to hash the agreement and produce a mock tx id.</div>
          </div>
        </div>
      </section>

      <!-- RIGHT: “Blockchain” / Tree Log -->
      <section class="card">
        <h2>Tree Ledger · Mock Explorer</h2>
        <div class="inner">
          <div class="row">
            <span class="pill">Chain: LTMX (dev)</span>
            <span class="pill">Status: <span class="ok">OK</span></span>
          </div>
          <pre id="explorer" class="mini muted">// transactions will appear here</pre>
        </div>
      </section>
    </main>

    <footer>
      <div class="mini">This is a front-end simulation: pulse → dialogue → agreement → sign &amp; record (mock). No real network calls are made.</div>
    </footer>
  </div>

  <script>
    // -------------------------------------------------------------------------
    // Mock data for pulses and matches
    const MY_PULSES = [
      {
        id: "pulse-7H3A",
        name: "Mentorship / Web Audit",
        // Optionally link to matches; for now matches are global
      },
      {
        id: "pulse-8K1Q",
        name: "Visual Identity / Photo",
      },
    ];

    // List of mock matches (same as previous example). In a real app these
    // would be fetched per pulse. Here, we reuse them for all pulses.
    const MOCK_MATCHES = [
      {
        id: "pulse-7H3A",
        partner: "willow@lisbon",
        overlap: ["mentorship", "frontend audit", "eco-design"],
        score: 0.86,
        note: "You both seek to mentor early initiates this month."
      },
      {
        id: "pulse-8K1Q",
        partner: "algarve-oak@portugal",
        overlap: ["photography", "visual identity"],
        score: 0.73,
        note: "Their leaf portfolio values symbolic identity & ritual media."
      }
    ];

    // DOM references
    const pulseListEl = document.getElementById("pulseList");
    const pulseSelectionEl = document.getElementById("pulseSelection");
    const interactionViewEl = document.getElementById("interactionView");
    const matchListEl = document.getElementById("matchList");
    const chatEl = document.getElementById("chat");
    const toTreeEl = document.getElementById("toTree");
    const pulseIdEl = document.getElementById("pulseId");
    const msgEl = document.getElementById("message");
    const leavesEl = document.getElementById("leaves");
    const explorerEl = document.getElementById("explorer");
    const agreementEl = document.getElementById("agreement");

    // Utility to create elements
    function el(tag, attrs = {}, ...children) {
      const n = document.createElement(tag);
      Object.entries(attrs).forEach(([k, v]) => (n[k] = v));
      for (const c of children) n.append(c.nodeType ? c : document.createTextNode(c));
      return n;
    }

    // -------------------------------------------------------------------------
    // Pulse selection
    function renderPulses() {
      pulseListEl.innerHTML = "";
      MY_PULSES.forEach(pulse => {
        const item = el("div", { className: "pulse-item", onclick: () => selectPulse(pulse) },
          el("div", { className: "pulse-name" }, pulse.name),
          el("div", { className: "pulse-id" }, pulse.id)
        );
        pulseListEl.append(item);
      });
    }

    function selectPulse(pulse) {
      // Populate the pulseId input for reference
      pulseIdEl.value = pulse.id;
      // Hide the selection view, show the interaction view
      pulseSelectionEl.style.display = "none";
      interactionViewEl.style.display = "block";
      // Set default toTree as empty
      toTreeEl.value = "";
      // Clear any existing chat and explorer logs
      chatEl.innerHTML = "";
      explorerEl.textContent = "";
      agreementEl.textContent = "// agreement summary will appear here";
      msgEl.value = "";
      leavesEl.value = "";
      // Render matches for this pulse
      renderMatchesForPulse(pulse.id);
      // Provide initial system message
      addMsg(`You have ${MOCK_MATCHES.filter(m => m.id === pulse.id).length} intention match(es) for this pulse.`, "sys");
    }

    // -------------------------------------------------------------------------
    // Match rendering
    function renderMatchesForPulse(pulseId) {
      matchListEl.innerHTML = "";
      const matches = MOCK_MATCHES.filter(m => m.id === pulseId);
      matches.forEach(m => {
        const rowTop = el("div", { className: "row" },
          el("strong", {}, m.partner),
          el("span", { className: "pill" }, `score ${Math.round(m.score * 100)}%`)
        );
        const rowTags = el("div", { className: "row" }, ...m.overlap.map(t => el("span", { className: "pill" }, t)));
        const rowNote = el("div", { className: "muted mini" }, m.note);
        const actions = el("div", { className: "row" },
          el("button", { className: "btn", onclick: () => viewMatch(m) }, "View"),
          el("button", { className: "btn primary", onclick: () => acceptMatch(m) }, "Start Dialogue")
        );
        const card = el("div", { className: "match" }, rowTop, rowTags, rowNote, actions);
        matchListEl.append(card);
      });
    }

    function viewMatch(m) {
      addMsg(`Viewing alignment with ${m.partner} (${m.id})`, "sys");
    }
    function acceptMatch(m) {
      toTreeEl.value = m.partner;
      pulseIdEl.value = m.id;
      addMsg(`iiyim → Recognized alignment on ${m.overlap.join(", ")}.`, "sys");
      addMsg(`Hello ${m.partner}, I can offer 2 hrs mentorship in exchange for a frontend audit and 1 leaf.`, "me");
      addMsg(`Hi! That sounds fair. I can complete the audit within 48 hours and include accessibility checks.`, "them");
      msgEl.focus();
    }

    // -------------------------------------------------------------------------
    // Chat helpers
    function addMsg(text, who = "them") {
      if (who === "sys") {
        chatEl.append(el("div", { className: "sys" }, text));
      } else {
        chatEl.append(el("div", { className: "msg " + (who === "me" ? "me" : "") }, text));
      }
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    // -------------------------------------------------------------------------
    // Agreement generation and signing (same as previous)
    function getAgreement() {
      const from = document.getElementById("fromTree").value.trim();
      const to = toTreeEl.value.trim();
      const pulse = pulseIdEl.value.trim();
      const leaves = parseFloat(leavesEl.value || "0");
      const terms = msgEl.value.trim();
      return {
        version: "ltmx-mock-0.1",
        pulse_id: pulse || null,
        from_tree: from || null,
        to_tree: to || null,
        terms: terms || "(no additional terms provided)",
        leaves: isFinite(leaves) ? leaves : 0,
        timestamp: new Date().toISOString(),
      };
    }
    // Web Crypto helper: SHA-256 hex
    async function sha256Hex(str) {
      const enc = new TextEncoder().encode(str);
      const digest = await crypto.subtle.digest("SHA-256", enc);
      return [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, "0")).join("");
    }
    // Signing and recording mock transaction
    async function signAndRecord() {
      const agreement = getAgreement();
      // rudimentary validation
      if (!agreement.from_tree || !agreement.to_tree) {
        addMsg("Please set both Lifetrees before signing.", "sys");
        return;
      }
      if (!agreement.pulse_id) {
        addMsg("Please choose a match (Pulse ID).", "sys");
        return;
      }
      const payload = JSON.stringify(agreement);
      const tx_hash = await sha256Hex(payload + Math.random().toString(36).slice(2));
      const tx = {
        network: "LTMX-dev",
        block_number: Math.floor(1000 + Math.random() * 9000),
        tx_hash,
        status: "success",
        agreement,
      };
      const prev = explorerEl.textContent.trim();
      explorerEl.textContent = (prev ? prev + "\n\n" : "") + JSON.stringify(tx, null, 2);
      addMsg("Agreement signed and recorded on the Tree (mock).", "sys");
    }

    // -------------------------------------------------------------------------
    // Event listeners for chat and agreement buttons
    document.getElementById("send").addEventListener("click", () => {
      const v = msgEl.value.trim();
      if (!v) return;
      addMsg(v, "me");
      // simple auto-reply
      setTimeout(() => addMsg("Acknowledged. Adding to draft agreement…", "them"), 500);
    });
    document.getElementById("genAgreement").addEventListener("click", () => {
      const a = getAgreement();
      agreementEl.textContent = JSON.stringify(a, null, 2);
      addMsg("Draft agreement generated.", "sys");
    });
    document.getElementById("signRecord").addEventListener("click", signAndRecord);

    // -------------------------------------------------------------------------
    // Initialize the app
    renderPulses();
  </script>

</body></html>